#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Created on Tue Oct  7 08:35:29 2025

@author: whadymacbook2016
"""
import CoolProp.CoolProp as CP
import numpy as np
from scipy.special import j0,j1
from scipy.interpolate import interp1d

# Propiedades del aire a 25°C
T_inf = 298.15  # K (25°C)
T_ini=300+273.15
P = 101325  # Pa (presión atmosférica)
u=10.0
D=0.20
L=0.4
V=np.pi*D**2/4*L
ks=401
cps=385
rhos=8933
alpha=ks/(rhos*cps)
t=20*60
r=0.05

# Biot numbers (comunes a las tres geometrías)
Bi_table = np.array([
    0.01,0.02,0.03,0.04,0.05,0.06,0.07,0.08,0.09,0.10,
    0.15,0.20,0.25,0.30,0.40,0.50,0.60,0.70,0.80,0.90,
    1.0,2.0,3.0,4.0,5.0,6.0,7.0,8.0,9.0,10.0,20.0,30.0,
    40.0,50.0,100.0,np.inf
])

# --- PARED PLANA ---
zeta_wall = np.array([
    0.0998,0.1410,0.1723,0.1987,0.2218,0.2425,0.2615,0.2791,0.2956,0.3111,
    0.3779,0.4328,0.4801,0.5218,0.5932,0.6533,0.7051,0.7506,0.7910,0.8274,
    0.8603,1.0769,1.1925,1.2646,1.3138,1.3496,1.3766,1.3978,1.4149,1.4289,
    1.4961,1.5202,1.5325,1.5400,1.5552,1.5708
])

C1_wall = np.array([
    1.0017,1.0033,1.0049,1.0066,1.0082,1.0098,1.0114,1.0130,1.0145,1.0161,
    1.0237,1.0311,1.0382,1.0450,1.0580,1.0701,1.0814,1.0919,1.1016,1.1107,
    1.1191,1.1785,1.2102,1.2287,1.2402,1.2479,1.2532,1.2570,1.2598,1.2620,
    1.2699,1.2717,1.2723,1.2727,1.2731,1.2733
])

# --- CILINDRO INFINITO ---
zeta_cyl = np.array([
    0.1412,0.1995,0.2440,0.2814,0.3143,0.3438,0.3709,0.3960,0.4195,0.4417,
    0.5376,0.6170,0.6856,0.7465,0.8516,0.9408,1.0184,1.0873,1.1490,1.2048,
    1.2558,1.5994,1.7887,1.9081,1.9898,2.0490,2.0937,2.1286,2.1566,2.1795,
    2.2881,2.3261,2.3455,2.3572,2.3809,2.4050
])

C1_cyl = np.array([
    1.0025,1.0050,1.0075,1.0099,1.0124,1.0148,1.0173,1.0197,1.0222,1.0246,
    1.0365,1.0483,1.0598,1.0712,1.0932,1.1143,1.1345,1.1539,1.1724,1.1902,
    1.2071,1.3384,1.4191,1.4698,1.5029,1.5253,1.5411,1.5526,1.5611,1.5677,
    1.5919,1.5973,1.5993,1.6002,1.6015,1.6018
])

# --- ESFERA ---
zeta_sph = np.array([
    0.1730,0.2445,0.2991,0.3450,0.3854,0.4217,0.4551,0.4860,0.5150,0.5423,
    0.6609,0.7593,0.8447,0.9208,1.0528,1.1656,1.2644,1.3525,1.4320,1.5044,
    1.5708,2.0288,2.2889,2.4556,2.5704,2.6537,2.7165,2.7654,2.8044,2.8363,
    2.9857,3.0372,3.0632,3.0788,3.1102,3.1415
])

C1_sph = np.array([
    1.0030,1.0060,1.0090,1.0120,1.0149,1.0179,1.0209,1.0239,1.0268,1.0298,
    1.0445,1.0592,1.0737,1.0880,1.1164,1.1441,1.1713,1.1978,1.2236,1.2488,
    1.2732,1.4793,1.6227,1.7202,1.7870,1.8338,1.8673,1.8920,1.9106,1.9249,
    1.9781,1.9898,1.9942,1.9962,1.9990,2.0000
])



rho = CP.PropsSI('D', 'T', T_inf, 'P', P, 'Air')  # Densidad (kg/m³)
mu = CP.PropsSI('V', 'T', T_inf, 'P', P, 'Air')  # Viscosidad dinámica (Pa.s)
nu = mu / rho  # Viscosidad cinemática (m²/s)
kf = CP.PropsSI('L', 'T', T_inf, 'P', P, 'Air')  # Conductividad térmica (W/m.K)
Pr = CP.PropsSI('PRANDTL', 'T', T_inf, 'P', P, 'Air')  # Número de Prandtl

ReD=rho*D*u/mu
NuD=0.3+(0.62*ReD**0.5*Pr**(1/3))/(1+(0.4/Pr)**(2/3))**(1/4)*\
    (1+(ReD/282000)**(5/8))**(4/5)
h=NuD*kf/D    

Bi=h*D/ks
Fo=alpha*t/D**2

f_cyl = interp1d(Bi_table, zeta_cyl)
epsilon = f_cyl(Bi)  # ejemplo

f_cyl = interp1d(Bi_table, C1_cyl)
C1 = f_cyl(Bi)  # ejemplo

#epsilon=0.1995
#C1=1.005

theta0=C1*np.exp(-epsilon**2*Fo)
rs=r/(D/2)
theta=C1*np.exp(-epsilon**2*Fo)*j0(epsilon*rs)

T0=theta0*(T_ini-T_inf)+T_inf
T=theta*(T_ini-T_inf)+T_inf
Q0=rhos*V*cps*(T_inf-T_ini)
Q=Q0*(1-2*theta0*j1(epsilon)/epsilon)
Q_over_Q0=Q/Q0







